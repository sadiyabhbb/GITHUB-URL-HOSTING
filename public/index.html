<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>HEADSHOT PANEL v4.7</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #050c12;
      --panel: #0f1418;
      --card: #11161a;
      --muted: #9aa3a9;
      --accent-a: #00ffd1;
      --accent-b: #00b3ff;
      --danger: #ff4b4b;
      --glass: rgba(255,255,255,0.02);
      --font: "Inter", system-ui, -apple-system, "Poppins", sans-serif;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      background:linear-gradient(180deg,var(--bg),#071018);
      color:#eaf2f3;
      font-family:var(--font);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    header{
      background:var(--panel);
      padding:14px 16px;
      display:flex;align-items:center;justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,0.04);
    }
    .brand h1{margin:0;color:var(--accent-a);font-size:18px}
    .brand small{color:var(--muted);font-size:12px}
    .menu-btn{background:transparent;border:none;color:var(--accent-a);font-size:22px;cursor:pointer}

    .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.3);backdrop-filter:blur(3px);opacity:0;pointer-events:none;transition:.25s;z-index:80}
    .overlay.show{opacity:1;pointer-events:auto}
    .sidebar{position:fixed;left:-260px;top:0;height:100%;width:260px;background:rgba(15,20,24,0.98);
      padding:28px 16px;display:flex;flex-direction:column;gap:12px;transition:left .28s;z-index:90;border-right:1px solid var(--glass)}
    .sidebar.show{left:0}
    .sidebar button{background:transparent;border:none;color:var(--muted);text-align:left;padding:10px;border-radius:8px;cursor:pointer;font-weight:600}
    .sidebar button:hover{color:var(--accent-a);background:rgba(255,255,255,0.02);transform:translateX(6px);transition:.14s}

    .wrap{max-width:1100px;margin:20px auto;padding:0 14px;display:grid;gap:16px}
    .panel{background:var(--panel);padding:14px;border-radius:12px;border:1px solid var(--glass);box-shadow:0 8px 30px rgba(0,0,0,0.45)}
    .title-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .meta{color:var(--muted);font-size:13px}

    .cards{display:flex;flex-direction:column;gap:12px;max-height:46vh;overflow:auto;padding-right:6px}
    .card{background:var(--card);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
    .card-head{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .card-title{color:var(--accent-a);font-weight:800}
    .card-sub{color:var(--muted);font-size:13px;margin-top:6px}
    .card-actions{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
    .btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .btn.accent{background:linear-gradient(90deg,var(--accent-a),var(--accent-b));color:#001}
    .btn.danger{background:var(--danger);color:#fff}

    .info-console{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));
      border-radius:10px;padding:12px;border:1px solid rgba(255,255,255,0.03);
      font-family:ui-monospace,monospace;font-size:13px}
    .json-box{background:#000;padding:14px;border-radius:8px;color:#fff;white-space:pre-wrap;overflow:auto;height:150px;border:1px solid rgba(255,255,255,0.03)}

    .neon-text{
      font-weight:700;
      background:linear-gradient(90deg,#00ffd1,#00b3ff,#a770ff,#ff7bd1);
      background-size:300% 100%;
      -webkit-background-clip:text;
      color:transparent;
      animation:neon 6s linear infinite;
    }
    @keyframes neon{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:200;opacity:0;pointer-events:none;transition:.18s}
    .modal.show{opacity:1;pointer-events:auto}
    .modal-card{width:min(980px,96%);max-height:86vh;background:var(--panel);border-radius:12px;padding:12px;border:1px solid var(--glass);display:flex;flex-direction:column}
    .modal-head{display:flex;justify-content:space-between;align-items:center;gap:8px;padding-bottom:8px}
    .modal-log{background:#000;color:#e6f0f2;padding:12px;border-radius:8px;overflow:auto;white-space:pre-wrap;font-family:ui-monospace,monospace;font-size:13px;flex:1;border:1px solid rgba(255,255,255,0.03)}

    @media(max-width:920px){.json-box{height:120px}}
    @media(max-width:520px){.json-box{height:100px}.btn{padding:7px 10px;font-size:13px}}
  </style>
</head>
<body>
<header>
  <div class="brand">
    <h1>HEADSHOT PANEL</h1>
    <small class="meta">v4.7 • Neon Dynamic</small>
  </div>
  <button id="menuBtn" class="menu-btn">☰</button>
</header>

<div id="overlay" class="overlay"></div>
<aside id="sidebar" class="sidebar">
  <button id="btnServers">Servers</button>
  <button id="btnCreate">Create Server</button>
  <button id="btnRefresh">Refresh</button>
</aside>

<main class="wrap">
  <section class="panel" id="serversSection">
    <div class="title-row">
      <div>
        <div style="font-weight:800;color:var(--accent-a)">Servers</div>
        <div class="meta" id="serverSummary">Loading...</div>
      </div>
      <div class="meta" id="runningCount"></div>
    </div>
    <div class="cards" id="cards"></div>
  </section>

  <section class="panel" id="createSection" style="display:none">
    <div style="font-weight:800;color:var(--accent-a)">Create Server</div>
    <div style="height:10px"></div>
    <input id="repo" placeholder="Git repo URL" class="input">
    <input id="entry" placeholder="Entry (index.js)" class="input">
    <input id="name" placeholder="Bot name (optional)" class="input">
    <div style="display:flex;gap:8px">
      <button id="createBtn" class="btn accent">Create</button>
      <button id="cancelCreate" class="btn ghost">Cancel</button>
    </div>
  </section>

  <section class="panel info-console">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="font-weight:800;color:var(--accent-a)">Host & Config Info</div>
      <div class="meta">Auto info • JSON</div>
    </div>
    <div class="json-box" id="infoBox"><span class="neon-text">Loading host info...</span></div>
  </section>
</main>

<div id="modal" class="modal">
  <div class="modal-card">
    <div class="modal-head">
      <div>
        <div id="modalTitle" style="font-weight:800;color:var(--accent-a)">Logs</div>
        <div id="modalMeta" class="meta">attached: -</div>
      </div>
      <div style="display:flex;gap:8px">
        <button id="modalCopy" class="btn ghost">Copy</button>
        <button id="modalClear" class="btn ghost">Clear</button>
        <button id="modalClose" class="btn danger">Close</button>
      </div>
    </div>
    <div id="modalLog" class="modal-log">No logs yet. Attach a bot from the list.</div>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
(function(){
  const socket = io();
  const cards = document.getElementById('cards');
  const infoBox = document.getElementById('infoBox');
  const menuBtn=document.getElementById('menuBtn'),sidebar=document.getElementById('sidebar'),overlay=document.getElementById('overlay');
  const btnServers=document.getElementById('btnServers'),btnCreate=document.getElementById('btnCreate'),btnRefresh=document.getElementById('btnRefresh');
  const createSection=document.getElementById('createSection'),serversSection=document.getElementById('serversSection');
  const repo=document.getElementById('repo'),entry=document.getElementById('entry'),name=document.getElementById('name');
  const createBtn=document.getElementById('createBtn'),cancelCreate=document.getElementById('cancelCreate');
  const modal=document.getElementById('modal'),modalLog=document.getElementById('modalLog'),modalTitle=document.getElementById('modalTitle'),modalMeta=document.getElementById('modalMeta');
  const modalCopy=document.getElementById('modalCopy'),modalClear=document.getElementById('modalClear'),modalClose=document.getElementById('modalClose');
  let attachedId=null,bots=[];

  function openSidebar(){sidebar.classList.add('show');overlay.classList.add('show');}
  function closeSidebar(){sidebar.classList.remove('show');overlay.classList.remove('show');}
  menuBtn.onclick=openSidebar;overlay.onclick=()=>{closeSidebar();closeModal();};
  btnServers.onclick=()=>{showSection('servers');closeSidebar();};
  btnCreate.onclick=()=>{showSection('create');closeSidebar();};
  btnRefresh.onclick=()=>{loadBots();closeSidebar();};

  function showSection(n){createSection.style.display=(n==='create'?'block':'none');serversSection.style.display=(n==='create'?'none':'block');}
  async function api(path,method='POST',body){return fetch(path,{method,headers:{'content-type':'application/json'},body:body?JSON.stringify(body):null}).then(r=>r.json());}

  createBtn.onclick=async()=>{
    if(!repo.value.trim())return;
    createBtn.disabled=true;createBtn.textContent='Creating...';
    await api('/api/deploy','POST',{repoUrl:repo.value.trim(),entry:entry.value.trim()||'index.js',name:name.value.trim()});
    repo.value=entry.value=name.value='';createBtn.disabled=false;createBtn.textContent='Create';showSection('servers');loadBots();
  };
  cancelCreate.onclick=()=>showSection('servers');

  function renderCards(list){
    bots=list||[];cards.innerHTML='';
    list.forEach(b=>{
      const c=document.createElement('div');c.className='card';
      c.innerHTML=`
        <div class="card-head"><div><div class="card-title">${b.name}</div><div class="card-sub">${b.entry}</div></div><div class="meta">${b.status}</div></div>
        <div class="card-actions">
          <button class="btn ghost" onclick="fetch('/api/${b.id}/start',{method:'POST'}).then(()=>loadBots())">Start</button>
          <button class="btn ghost" onclick="fetch('/api/${b.id}/stop',{method:'POST'}).then(()=>loadBots())">Stop</button>
          <button class="btn ghost" onclick="fetch('/api/${b.id}/restart',{method:'POST'}).then(()=>loadBots())">Restart</button>
          <button class="btn ghost" onclick="fetch('/api/${b.id}/update',{method:'POST'}).then(()=>loadBots())">Update</button>
          <button class="btn danger" onclick="fetch('/api/${b.id}/delete',{method:'DELETE'}).then(()=>loadBots())">Delete</button>
          <button class="btn ghost" onclick="openModal('${b.id}','${b.name}')">Logs</button>
        </div>`;
      cards.appendChild(c);
    });
  }

  function openModal(id,name){attachedId=id;modal.classList.add('show');modalTitle.textContent='Server Console — '+name;modalMeta.textContent='attached: '+name;modalLog.textContent='Loading logs...';socket.emit('subscribe',id);fetch('/api/'+id+'/logs').then(r=>r.json()).then(j=>{modalLog.textContent=(j.logs||[]).join('');});}
  function closeModal(){modal.classList.remove('show');attachedId=null;}
  modalClose.onclick=closeModal;
  modalCopy.onclick=async()=>{await navigator.clipboard.writeText(modalLog.textContent);modalCopy.textContent='Copied';setTimeout(()=>modalCopy.textContent='Copy',800);}
  modalClear.onclick=()=>modalLog.textContent='';

  socket.on('bots',renderCards);
  socket.on('log',({id,text})=>{if(attachedId===id){modalLog.textContent+=text;modalLog.scrollTop=modalLog.scrollHeight;}});

  async function updateInfo(){
    try{
      const h=await fetch('/api/host').then(r=>r.json());
      const b=await fetch('/api/bots').then(r=>r.json());
      const obj={host:h,panel:{version:'v4.7',bots_total:b.length,bots_running:b.filter(x=>x.status==='running').length,uptime:uptime()}};
      const s=JSON.stringify(obj,null,2).replace(/"([^"]+)":/g,'<span style="color:#7ad1ff">"$1"</span>:').replace(/:\s*"([^"]+)"/g,': <span style="color:#ffd58a">"$1"</span>').replace(/:\s*(\d+)/g,': <span style="color:#8cffb3">$1</span>');
      infoBox.innerHTML=`<div class="neon-text">${s}</div>`;
    }catch(e){infoBox.textContent='Host info error.';}
  }

  const start=Date.now();
  function uptime(){let t=Math.floor((Date.now()-start)/1000),h=Math.floor(t/3600),m=Math.floor((t%3600)/60),s=t%60;return `${h}h ${m}m ${s}s`;}
  function loadBots(){fetch('/api/bots').then(r=>r.json()).then(renderCards).then(updateInfo);}
  loadBots();setInterval(updateInfo,5000);
})();
</script>
</body>
</html>
