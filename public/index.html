<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HEADSHOT PANEL v3.6 (Pro Edition)</title>

  <style>
    :root{
      --bg:#06070a;
      --panel:#0f1315;
      --muted:#98a0a6;
      --accent:#00ff88;
      --accent-weak: rgba(0,255,136,0.06);
      --glass: rgba(255,255,255,0.02);
      --white: #ffffff;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter, "Segoe UI", system-ui, -apple-system, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#030405 0%, #071014 100%);
      color:var(--white);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:20px;
    }

    header{
      max-width:1200px;
      margin:0 auto 18px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
    .brand h1 { margin:0; color:var(--accent); font-size:18px; letter-spacing:0.6px; }
    .brand small{ color:var(--muted); font-size:12px; }

    .btn { background:linear-gradient(90deg,var(--accent), #00d68a); color:#04120b; padding:8px 12px; border-radius:8px; border:none; cursor:pointer; font-weight:700; }
    .btn.ghost { background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.03); }

    .wrap { max-width:1200px; margin:0 auto; display:grid; grid-template-columns:1fr 440px; gap:18px; align-items:start; }
    @media(max-width:980px){ .wrap { grid-template-columns: 1fr; } }

    .panel { background:var(--panel); border-radius:12px; padding:14px; border:1px solid rgba(255,255,255,0.02); box-shadow:0 10px 30px rgba(0,0,0,0.6); }

    .deploy-row { display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom:8px; }
    .deploy-row input { background:transparent; border:1px solid rgba(255,255,255,0.04); padding:10px 12px; border-radius:8px; color:var(--white); flex:1; }

    .bots { display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:12px; margin-top:10px; }
    .bot-card { background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:12px; border-radius:10px; border:1px solid var(--accent-weak); display:flex; flex-direction:column; gap:10px; transition:all .2s ease; }
    .bot-card:hover { border-color:var(--accent); box-shadow:0 0 10px rgba(0,255,136,0.1); }

    .bot-row { display:flex; justify-content:space-between; align-items:flex-start; gap:8px; }
    .bot-name { font-weight:700; color:#eafff0; font-size:14px; }
    .status { font-size:12px; padding:6px 8px; border-radius:8px; display:inline-flex; align-items:center; gap:8px; }
    .dot { width:10px; height:10px; border-radius:50%; display:inline-block; }
    .running { color:var(--accent); }
    .running .dot { background:var(--accent); }
    .stopped { color:#ff6b6b; }
    .installing { color:#ffb86b; }
    .uptime { font-weight:700; color:#dfffe6; font-size:13px; text-align:right; }

    .action-btn { padding:8px 10px; border-radius:8px; border:none; cursor:pointer; font-weight:700; font-size:13px; color:#04120b; background:var(--accent); }
    .action-btn.ghost { background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.05); }

    .log-viewport {
      background:#000;
      border-radius:10px;
      padding:12px;
      min-height:420px;
      max-height:70vh;
      overflow:auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      font-size:13px;
      color:var(--white);
      border:1px solid rgba(255,255,255,0.02);
      white-space: pre;
      scroll-behavior: smooth;
    }

    .status-strip { margin-top:8px; padding:8px 10px; border-radius:8px; background:var(--accent-weak); color:var(--accent); font-weight:700; display:none; text-align:center; }

    footer { margin-top:18px; text-align:center; color:var(--muted); font-size:13px; }
  </style>

  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <header>
    <div class="brand">
      <h1>HEADSHOT PANEL v3.6</h1>
      <small>Pro Edition — Deploy • Update • Uptime • Logs</small>
    </div>
    <div class="header-actions">
      <button id="refreshBtn" class="btn ghost">Refresh</button>
      <div id="serverTime" class="muted"></div>
    </div>
  </header>

  <main class="wrap">
    <section>
      <div class="panel">
        <h2>Deploy / Update</h2>
        <div class="deploy-row">
          <input id="repo" placeholder="Git repo URL">
          <input id="name" placeholder="Optional name" style="max-width:220px;">
          <input id="entry" placeholder="entry (index.js)" style="max-width:140px;">
          <button id="deployBtn" class="btn">Deploy</button>
        </div>
        <div id="deployStatus" class="status-strip"></div>
      </div>

      <div class="panel" style="margin-top:14px;">
        <h2>Deployed Bots</h2>
        <div id="bots" class="bots"></div>
      </div>
    </section>

    <aside class="panel">
      <h2>Live Logs</h2>
      <div id="attachedName" class="muted">No attached bot</div>
      <pre id="logs" class="log-viewport">No logs yet.</pre>
      <div class="status-strip" id="statusStrip"></div>
    </aside>
  </main>

  <footer>© HEADSHOT PANEL v3.6 — Auto Update + Restart Engine</footer>

<script>
(function(){
  const socket = io();
  let bots = [];
  let attachedId = localStorage.getItem('attachedId') || null;
  const logsEl = document.getElementById('logs');
  const attachedNameEl = document.getElementById('attachedName');
  const statusStrip = document.getElementById('statusStrip');
  const deployStatus = document.getElementById('deployStatus');

  function showStatus(msg,time=3000){
    statusStrip.textContent = msg;
    statusStrip.style.display = 'block';
    setTimeout(()=>statusStrip.style.display='none',time);
  }
  function showDeploy(msg,time=4000){
    deployStatus.textContent = msg;
    deployStatus.style.display = 'block';
    setTimeout(()=>deployStatus.style.display='none',time);
  }
  function fmtUptime(ms){
    if(!ms) return '-';
    const s=Math.floor(ms/1000);
    const h=Math.floor(s/3600);
    const m=Math.floor((s%3600)/60);
    const sec=s%60;
    if(h) return `${h}h ${m}m ${sec}s`;
    if(m) return `${m}m ${sec}s`;
    return `${sec}s`;
  }

  async function apiGet(p){const r=await fetch('/api'+p);return r.json();}
  async function apiPost(p,b){const r=await fetch('/api'+p,{method:'POST',headers:{'content-type':'application/json'},body:b?JSON.stringify(b):undefined});return r.json();}

  async function refreshBots(){
    const list = await apiGet('/bots');
    bots = list || [];
    const container = document.getElementById('bots');
    container.innerHTML='';
    if(bots.length===0){container.innerHTML='<div class="muted">No bots yet.</div>';return;}
    bots.forEach(b=>{
      const card=document.createElement('div');
      card.className='bot-card';
      const sClass=b.status==='running'?'running':(b.status==='installing'?'installing':'stopped');
      const uptime=b.uptime?fmtUptime(b.uptime):'-';
      card.innerHTML=`
        <div class="bot-row">
          <div>
            <div class="bot-name">${b.name}</div>
            <div class="status ${sClass}"><span class="dot"></span>${b.status}</div>
          </div>
          <div class="uptime">${uptime}</div>
        </div>
        <div class="bot-actions">
          <button class="action-btn" data-act="start" data-id="${b.id}">Start</button>
          <button class="action-btn ghost" data-act="stop" data-id="${b.id}">Stop</button>
          <button class="action-btn ghost" data-act="attach" data-id="${b.id}">Attach</button>
          <button class="action-btn ghost" data-act="update" data-id="${b.id}">Update</button>
        </div>`;
      container.appendChild(card);
    });
    container.querySelectorAll('[data-act]').forEach(btn=>{
      btn.onclick=async()=>{
        const id=btn.dataset.id,act=btn.dataset.act;
        if(act==='start'){await apiPost('/'+id+'/start');showStatus('Started '+id);}
        else if(act==='stop'){await apiPost('/'+id+'/stop');showStatus('Stopped '+id);}
        else if(act==='attach'){attachTo(id);}
        else if(act==='update'){showStatus('Updating...');await apiPost('/deploy',{repoUrl:'',name:bots.find(x=>x.id===id).name,entry:'index.js'});showStatus('Updated & restarted');}
        refreshBots();
      };
    });
  }

  async function attachTo(id){
    attachedId=id;localStorage.setItem('attachedId',id);
    const b=bots.find(x=>x.id===id);
    attachedNameEl.textContent=b?b.name:'Unknown';
    const j=await apiGet('/'+id+'/logs');
    logsEl.textContent=(j.logs||[]).join('');
    logsEl.scrollTop=logsEl.scrollHeight;
    socket.emit('subscribe',id);
    showStatus('Attached to '+b.name);
  }

  document.getElementById('deployBtn').onclick=async()=>{
    const repo=document.getElementById('repo').value.trim();
    const name=document.getElementById('name').value.trim();
    const entry=document.getElementById('entry').value.trim()||'index.js';
    if(!repo){showDeploy('Enter repo URL');return;}
    showDeploy('Deploying...');
    const r=await apiPost('/deploy',{repoUrl:repo,name,entry});
    if(r.error)showDeploy('❌ '+r.error,5000);
    else showDeploy('✅ Done '+r.name,4000);
    refreshBots();
  };

  document.getElementById('refreshBtn').onclick=()=>{refreshBots();showStatus('Refreshed');};

  socket.on('bots',list=>{bots=list;refreshBots();});
  socket.on('log',d=>{logsEl.textContent+=String(d);logsEl.scrollTop=logsEl.scrollHeight;});
  socket.on('init',d=>{logsEl.textContent=String(d);logsEl.scrollTop=logsEl.scrollHeight;});

  function updateServerTime(){document.getElementById('serverTime').textContent=new Date().toLocaleTimeString();}
  setInterval(updateServerTime,1000);updateServerTime();

  refreshBots();
})();
</script>
</body>
</html>
