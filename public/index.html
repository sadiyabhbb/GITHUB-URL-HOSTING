<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>HEADSHOT PANEL v4.1</title>

  <style>
    :root{
      --bg:#0b0f14;
      --panel:#0f1418;
      --card:#11161a;
      --muted:#9aa6b2;
      --accent:#00ffd1;
      --accent-2:#00b3ff;
      --danger:#ff5b5b;
      --brand-font: system-ui, "Poppins", "Inter", sans-serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:linear-gradient(180deg,#071018,#0b0f14);
      color:#e6f0f2;
      font-family:var(--brand-font);
      padding:12px;
    }
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;max-width:1100px;margin:0 auto 12px;}
    .brand h1{margin:0;color:var(--accent);font-size:18px;font-weight:700;}
    .brand small{color:var(--muted);font-size:12px;}
    .menu-btn{background:transparent;border:1px solid rgba(255,255,255,0.05);padding:8px;border-radius:8px;color:var(--muted);cursor:pointer;}
    .menu-drawer{
      position:fixed;top:65px;right:15px;background:var(--panel);
      border:1px solid rgba(255,255,255,0.05);border-radius:12px;
      padding:15px;width:90%;max-width:420px;display:none;flex-direction:column;gap:10px;
      box-shadow:0 0 20px #00fff533;z-index:50;
    }
    .menu-drawer.active{display:flex;}
    .menu-drawer input{background:var(--card);border:1px solid #1a252a;color:var(--muted);padding:10px;border-radius:8px;}
    .menu-drawer button{background:linear-gradient(90deg,var(--accent),var(--accent-2));border:none;padding:10px;border-radius:8px;color:#001;font-weight:700;cursor:pointer;}
    .top-row{max-width:1100px;margin:0 auto 8px;display:flex;align-items:center;justify-content:space-between;}
    .small{font-size:13px;color:var(--muted);}
    .layout{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:1fr;gap:14px;}
    .console-box{background:#000;color:#fff;font-family:ui-monospace,monospace;font-size:13px;padding:12px;border-radius:10px;height:450px;overflow:auto;white-space:pre-wrap;border:1px solid rgba(255,255,255,0.05);}
    .controls{display:flex;justify-content:space-between;align-items:center;margin-top:10px;}
    .btn{padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600;}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.05);color:var(--muted);}
    .btn.accent{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#001;}
    .btn.danger{background:var(--danger);color:#fff;}
    .host-info{background:linear-gradient(90deg,rgba(0,255,209,0.03),rgba(0,179,255,0.02));padding:10px;border-radius:8px;font-size:13px;color:var(--muted);margin-top:10px;}
    .cards{display:flex;flex-direction:column;gap:10px;max-height:60vh;overflow:auto;padding-right:6px;}
    .card{background:var(--panel);border-radius:10px;padding:12px;border:1px solid rgba(255,255,255,0.05);}
    .card-head{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;}
    .card-title{font-weight:700;color:var(--accent);}
    .meta{color:var(--muted);font-size:13px;}
    .card-actions{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;}
    @media(max-width:600px){.console-box{height:320px;}}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <h1>HEADSHOT PANEL</h1>
      <small>v4.1 â€¢ Dark Neon â€¢ Stable</small>
    </div>
    <button id="menuBtn" class="menu-btn">â˜°</button>
  </header>

  <div id="menuDrawer" class="menu-drawer">
    <input id="repoUrl" placeholder="Git repo URL (https://github.com/user/repo.git)">
    <input id="entryFile" placeholder="Entry (index.js)">
    <input id="botName" placeholder="Bot name (optional)">
    <button id="deployBtn">Deploy</button>
  </div>

  <div class="top-row">
    <div class="small">Manage bots â€” deploy, update, start/stop, view logs & host info</div>
    <div id="summary" class="small">Loading...</div>
  </div>

  <div class="layout">
    <div class="cards" id="cards"></div>
    <div class="console-box" id="console">ðŸ§  Console ready...</div>
    <div class="controls">
      <div>
        <button id="copyLogs" class="btn ghost">Copy Logs</button>
        <button id="clearLogs" class="btn ghost">Clear</button>
      </div>
      <div class="small" id="attached">No bot attached</div>
    </div>
    <div class="host-info" id="hostInfo">Host info loading...</div>
  </div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const menuBtn=document.getElementById("menuBtn");
const menuDrawer=document.getElementById("menuDrawer");
const deployBtn=document.getElementById("deployBtn");
const consoleBox=document.getElementById("console");
const repoUrl=document.getElementById("repoUrl");
const entryFile=document.getElementById("entryFile");
const botName=document.getElementById("botName");
const copyLogs=document.getElementById("copyLogs");
const clearLogs=document.getElementById("clearLogs");
const attached=document.getElementById("attached");
const cards=document.getElementById("cards");
const summary=document.getElementById("summary");
const hostInfo=document.getElementById("hostInfo");
let bots=[];

menuBtn.onclick=()=>menuDrawer.classList.toggle("active");

deployBtn.onclick=async()=>{
  const repo=repoUrl.value.trim(),entry=entryFile.value.trim(),name=botName.value.trim();
  if(!repo||!entry)return alert("Enter repo URL & entry file");
  socket.emit("deploy",{repo,entry,name});
  appendLog(`ðŸš€ Deploying ${name||"Unnamed Bot"}...`);
  menuDrawer.classList.remove("active");
};

socket.on("bots",list=>renderBots(list));
socket.on("log",d=>{
  if(typeof d==="string")appendLog(d);
  else if(d.text)appendLog(`[${d.id}] ${d.text}`);
});
socket.on("attached",b=>attached.textContent=`Attached: ${b}`);

copyLogs.onclick=()=>{navigator.clipboard.writeText(consoleBox.innerText);appendLog("ðŸ“‹ Logs copied.");};
clearLogs.onclick=()=>consoleBox.textContent="ðŸ§  Console cleared.";

function appendLog(t){const l=document.createElement("div");l.textContent=t;consoleBox.appendChild(l);consoleBox.scrollTop=consoleBox.scrollHeight;}
function renderBots(list){
  bots=list;
  cards.innerHTML="";
  list.forEach(b=>{
    const c=document.createElement("div");c.className="card";c.innerHTML=`
      <div class="card-head">
        <div><div class="card-title">${b.name}</div><div class="meta">entry: ${b.entry}</div></div>
        <div class="meta">${b.status==="running"?"ðŸŸ¢ running":"ðŸ”´ stopped"}</div>
      </div>
      <div class="card-actions">
        <button class="btn accent start">Start</button>
        <button class="btn ghost stop">Stop</button>
        <button class="btn ghost restart">Restart</button>
        <button class="btn ghost update">Update</button>
        <button class="btn danger delete">Delete</button>
      </div>`;
    c.querySelector(".start").onclick=()=>socket.emit("action",{id:b.id,cmd:"start"});
    c.querySelector(".stop").onclick=()=>socket.emit("action",{id:b.id,cmd:"stop"});
    c.querySelector(".restart").onclick=()=>socket.emit("action",{id:b.id,cmd:"restart"});
    c.querySelector(".update").onclick=()=>socket.emit("action",{id:b.id,cmd:"update"});
    c.querySelector(".delete").onclick=()=>socket.emit("action",{id:b.id,cmd:"delete"});
    cards.appendChild(c);
  });
  summary.textContent=`${list.filter(x=>x.status==="running").length} running â€¢ ${list.filter(x=>x.status!=="running").length} stopped â€¢ ${list.length} total`;
}

fetch("/api/host").then(r=>r.json()).then(h=>{
  hostInfo.innerHTML=`<div><b>Node:</b> ${h.node} â€¢ <b>Platform:</b> ${h.platform}/${h.arch}</div>
  <div style="margin-top:6px"><b>Path:</b> ${h.cwd}</div>
  <div style="margin-top:6px"><b>CPUs:</b> ${h.cpus} â€¢ <b>Bots:</b> ${h.bots}</div>`;
});
</script>
</body>
</html>
