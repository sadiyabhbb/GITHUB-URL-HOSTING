<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Xavia Panel v4.7</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      background:#0d1117;
      color:#c9d1d9;
      font-family:"Fira Code",monospace;
      display:flex;
      min-height:100vh;
      overflow-x:hidden;
    }
    #sidebar{
      width:240px;
      background:#161b22;
      border-right:1px solid #30363d;
      position:fixed;
      left:-260px;
      top:0;
      bottom:0;
      transition:0.3s;
      padding:1rem;
      display:flex;
      flex-direction:column;
      gap:1rem;
      z-index:999;
    }
    #sidebar.show{left:0}
    #overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.6);
      display:none;
    }
    #overlay.show{display:block;}
    .btn{
      background:#238636;
      color:#fff;
      padding:0.5rem 1rem;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-size:14px;
      transition:0.2s;
    }
    .btn:hover{background:#2ea043;}
    .btn.ghost{background:transparent;border:1px solid #30363d;}
    .btn.ghost:hover{background:#21262d;}
    .btn.danger{background:#da3633;}
    .btn.danger:hover{background:#f85149;}
    #main{
      flex:1;
      margin-left:0;
      transition:0.3s;
      width:100%;
      padding:1rem;
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      background:#161b22;
      padding:0.8rem 1rem;
      border-bottom:1px solid #30363d;
      border-radius:8px;
    }
    #menuBtn{
      background:none;
      border:none;
      color:#fff;
      font-size:20px;
      cursor:pointer;
    }
    #cards{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
      gap:1rem;
      margin-top:1rem;
    }
    .card{
      background:#161b22;
      border:1px solid #30363d;
      border-radius:8px;
      padding:1rem;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      box-shadow:0 0 5px rgba(0,0,0,0.4);
    }
    .card-head{display:flex;align-items:center;justify-content:space-between;}
    .card-title{font-weight:600;font-size:1rem;color:#58a6ff;}
    .card-sub{font-size:0.85rem;color:#8b949e;}
    .card-actions{display:flex;flex-wrap:wrap;gap:0.4rem;margin-top:0.8rem;}
    #createSection,#serversSection{display:none;margin-top:1rem;}
    input{
      width:100%;
      padding:0.5rem;
      background:#0d1117;
      border:1px solid #30363d;
      border-radius:6px;
      color:#fff;
      margin-bottom:0.7rem;
      font-family:"Fira Code";
    }
    #modal{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.8);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:1000;
    }
    #modal.show{display:flex;}
    .modal-inner{
      background:#161b22;
      border:1px solid #30363d;
      border-radius:8px;
      width:95%;
      max-width:900px;
      height:80%;
      display:flex;
      flex-direction:column;
      padding:1rem;
      box-shadow:0 0 15px rgba(0,255,200,0.2);
      animation:glow 3s ease-in-out infinite alternate;
    }
    @keyframes glow {
      from { box-shadow: 0 0 10px rgba(0,255,150,0.2); }
      to { box-shadow: 0 0 25px rgba(0,255,200,0.5); }
    }
    #modalLog{
      flex:1;
      overflow-y:auto;
      white-space:pre-wrap;
      font-size:13px;
      background:#0d1117;
      padding:1rem;
      border-radius:6px;
      border:1px solid #30363d;
      color:#9eeeff;
      text-shadow:0 0 3px rgba(0,255,200,0.3);
      animation:fadeIn 1s ease-in-out;
    }
    @keyframes fadeIn {from{opacity:0;}to{opacity:1;}}
  </style>
</head>
<body>
  <div id="overlay"></div>
  <aside id="sidebar">
    <h2 style="color:#58a6ff;">Xavia Panel</h2>
    <button class="btn" id="btnServers">Servers</button>
    <button class="btn" id="btnCreate">Create Bot</button>
    <button class="btn ghost" id="btnRefresh">Refresh</button>
  </aside>

  <main id="main">
    <header>
      <button id="menuBtn">☰</button>
      <h2>Xavia Control</h2>
    </header>

    <section id="serversSection">
      <h3 style="margin-top:1rem;">Server List</h3>
      <div id="serverSummary" style="color:#8b949e;font-size:14px;margin:0.4rem 0;">Loading...</div>
      <div id="cards"></div>

      <h3 style="margin-top:2rem;">Host & Config Info</h3>
      <div id="infoBox" style="height:250px;overflow:auto;background:#000;padding:0.8rem;border-radius:8px;border:1px solid #30363d;font-size:14px;"></div>
    </section>

    <section id="createSection">
      <h3 style="margin-top:1rem;">Create New Bot</h3>
      <input id="repo" placeholder="Repository URL" />
      <input id="entry" placeholder="Entry File (default: index.js)" />
      <input id="name" placeholder="Bot Name (optional)" />
      <div style="display:flex;gap:0.5rem;">
        <button class="btn" id="createBtn">Create</button>
        <button class="btn ghost" id="cancelCreate">Cancel</button>
      </div>
    </section>
  </main>

  <div id="modal">
    <div class="modal-inner">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div>
          <div id="modalTitle" style="color:#58a6ff;">Console</div>
          <div id="modalMeta" style="font-size:12px;color:#8b949e;"></div>
        </div>
        <div style="display:flex;gap:0.5rem;">
          <button class="btn ghost" id="modalCopy">Copy</button>
          <button class="btn ghost" id="modalClear">Clear</button>
          <button class="btn danger" id="modalClose">Close</button>
        </div>
      </div>
      <pre id="modalLog">Loading...</pre>
    </div>
  </div>

  <script>
  (function(){
    const socket = io();
    const cards=document.getElementById('cards');
    const infoBox=document.getElementById('infoBox');
    const modal=document.getElementById('modal');
    const modalLog=document.getElementById('modalLog');
    const modalTitle=document.getElementById('modalTitle');
    const modalMeta=document.getElementById('modalMeta');
    const modalClose=document.getElementById('modalClose');
    const modalCopy=document.getElementById('modalCopy');
    const modalClear=document.getElementById('modalClear');
    let attachedId=null;

    function openModal(id,name){
      attachedId=id;
      modal.classList.add('show');
      modalTitle.textContent='Server Console — '+name;
      modalMeta.textContent='Attached: '+id;
      modalLog.textContent='Loading logs...';
      socket.emit('subscribe',id);
      fetch(`/api/${id}/logs`).then(r=>r.json()).then(j=>{
        modalLog.textContent=(j.logs||[]).join('');
        modalLog.scrollTop=modalLog.scrollHeight;
      });
    }

    function closeModal(){
      modal.classList.remove('show');
      if(attachedId){socket.emit('unsubscribe',attachedId);}
      attachedId=null;
    }

    modalClose.onclick=closeModal;
    modalCopy.onclick=async()=>{
      await navigator.clipboard.writeText(modalLog.textContent);
      modalCopy.textContent='Copied!';
      setTimeout(()=>modalCopy.textContent='Copy',1000);
    };
    modalClear.onclick=()=>modalLog.textContent='';

    socket.on('bots',renderCards);
    socket.on('log',({id,text})=>{
      if(attachedId===id){
        modalLog.textContent+=text;
        modalLog.scrollTop=modalLog.scrollHeight;
      }
    });

    function renderCards(list){
      cards.innerHTML='';
      list.forEach(b=>{
        const c=document.createElement('div');
        c.className='card';
        c.innerHTML=`
          <div class="card-head">
            <div>
              <div class="card-title">${b.name}</div>
              <div class="card-sub">${b.entry}</div>
            </div>
            <div class="meta">${b.status}</div>
          </div>
          <div class="card-actions">
            <button class="btn ghost" onclick="fetch('/api/${b.id}/start',{method:'POST'}).then(()=>loadBots())">Start</button>
            <button class="btn ghost" onclick="fetch('/api/${b.id}/stop',{method:'POST'}).then(()=>loadBots())">Stop</button>
            <button class="btn ghost" onclick="openModal('${b.id}','${b.name}')">Logs</button>
            <button class="btn danger" onclick="fetch('/api/${b.id}/delete',{method:'DELETE'}).then(()=>loadBots())">Delete</button>
          </div>`;
        cards.appendChild(c);
      });
    }

    async function loadBots(){
      const res=await fetch('/api/bots');
      const data=await res.json();
      renderCards(data);
    }
    loadBots();
  })();
  </script>
</body>
</html>
