<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Xavia Panel v4.7</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Fira Code',monospace}
    body{background:#0d1117;color:#c9d1d9;overflow:hidden}
    header{height:60px;background:#161b22;display:flex;align-items:center;justify-content:space-between;padding:0 20px;border-bottom:1px solid #30363d}
    header h1{font-size:18px;color:#58a6ff}
    .container{display:flex;height:calc(100vh - 60px)}
    aside{width:230px;background:#161b22;border-right:1px solid #30363d;padding:15px;transition:.3s}
    aside button{width:100%;background:#21262d;color:#c9d1d9;border:none;padding:10px;margin-bottom:10px;border-radius:8px;cursor:pointer;transition:.2s}
    aside button:hover,aside button.active{background:#58a6ff;color:#fff}
    main{flex:1;position:relative;overflow:auto;padding:20px}
    .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:20px}
    .card{background:#161b22;border:1px solid #30363d;border-radius:12px;padding:15px;box-shadow:0 0 8px #0005;transition:.3s;animation:fadeIn .4s ease}
    .card:hover{transform:translateY(-3px);border-color:#58a6ff}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .card h3{color:#58a6ff;margin-bottom:8px}
    .card .status{font-size:12px;margin-bottom:8px}
    .card button{background:#21262d;border:none;padding:6px 10px;border-radius:6px;color:#c9d1d9;margin-right:5px;cursor:pointer;transition:.2s}
    .card button:hover{background:#58a6ff;color:#fff}
    .modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0.8);width:90%;max-width:900px;height:80%;background:#0d1117;border:1px solid #30363d;border-radius:12px;display:none;flex-direction:column;z-index:1000;transition:.3s ease-in-out;opacity:0;box-shadow:0 0 20px #000a}
    .modal.show{display:flex;opacity:1;transform:translate(-50%,-50%) scale(1)}
    .modal header{background:#161b22;border-bottom:1px solid #30363d;padding:10px 15px;display:flex;justify-content:space-between;align-items:center}
    .modal header h2{color:#58a6ff;font-size:16px}
    .modal header button{background:none;border:none;color:#c9d1d9;font-size:18px;cursor:pointer}
    .modal pre{flex:1;background:#0d1117;padding:15px;overflow-y:auto;white-space:pre-wrap;font-size:13px}
    .modal footer{background:#161b22;padding:10px;border-top:1px solid #30363d;display:flex;justify-content:flex-end;gap:10px}
    .modal footer button{background:#21262d;color:#c9d1d9;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;transition:.2s}
    .modal footer button:hover{background:#58a6ff;color:#fff}
  </style>
</head>
<body>
  <header>
    <h1>Xavia Panel v4.7</h1>
    <div id="infoBox"></div>
  </header>
  <div class="container">
    <aside>
      <button class="active" onclick="showSection('servers')">Servers</button>
      <button onclick="showSection('settings')">Settings</button>
      <button onclick="showSection('about')">About</button>
    </aside>
    <main id="main">
      <section id="servers" class="section active">
        <div class="cards" id="cards"></div>
      </section>
      <section id="settings" class="section" style="display:none">
        <h2>Settings</h2>
      </section>
      <section id="about" class="section" style="display:none">
        <h2>About Xavia Panel</h2>
        <p>Version 4.7 â€” Built for lightweight bot hosting & monitoring.</p>
      </section>
    </main>
  </div>

  <div class="modal" id="modal">
    <header>
      <h2 id="modalTitle">Server Console</h2>
      <button id="modalClose">&times;</button>
    </header>
    <pre id="modalLog">Loading...</pre>
    <footer>
      <button id="modalCopy">Copy</button>
      <button id="modalClear">Clear</button>
    </footer>
  </div>

  <script>
  (()=>{

    const socket = io();
    const cardsContainer = document.getElementById("cards");
    const modal = document.getElementById("modal");
    const modalTitle = document.getElementById("modalTitle");
    const modalLog = document.getElementById("modalLog");
    const modalClose = document.getElementById("modalClose");
    const modalCopy = document.getElementById("modalCopy");
    const modalClear = document.getElementById("modalClear");
    let attachedId = null;

    // --- Render Cards ---
    function renderCards(bots=[]){
      cardsContainer.innerHTML="";
      bots.forEach(b=>{
        const div=document.createElement("div");
        div.className="card";
        div.innerHTML=`
          <h3>${b.name}</h3>
          <div class="status">Status: ${b.status?"ðŸŸ¢ Online":"ðŸ”´ Offline"}</div>
          <button onclick="startBot('${b.id}')">Start</button>
          <button onclick="stopBot('${b.id}')">Stop</button>
          <button onclick="openModal('${b.id}','${b.name}')">Logs</button>`;
        cardsContainer.appendChild(div);
      });
    }

    function showSection(id){
      document.querySelectorAll('.section').forEach(s=>s.style.display='none');
      document.querySelectorAll('aside button').forEach(b=>b.classList.remove('active'));
      document.getElementById(id).style.display='block';
      document.querySelector(`aside button[onclick="showSection('${id}')"]`).classList.add('active');
    }

    function startBot(id){socket.emit("start",id);}
    function stopBot(id){socket.emit("stop",id);}

    // --- Modal ---
    function openModal(id,name){
      attachedId=id;
      modal.classList.add("show");
      modalTitle.textContent="Server Console â€” "+name;
      modalLog.textContent="Loading logs...";
      socket.emit("subscribe",id);
      fetch(`/api/${id}/logs`).then(r=>r.json()).then(j=>{
        modalLog.textContent=(j.logs||[]).join('');
        modalLog.scrollTop=modalLog.scrollHeight;
      });
    }

    function closeModal(){
      if(attachedId){
        socket.emit("unsubscribe",attachedId);
        attachedId=null;
      }
      modal.classList.remove("show");
    }

    window.openModal=openModal;
    window.closeModal=closeModal;

    modalClose.onclick=closeModal;
    modalCopy.onclick=async()=>{
      await navigator.clipboard.writeText(modalLog.textContent);
      modalCopy.textContent="Copied";
      setTimeout(()=>modalCopy.textContent="Copy",800);
    };
    modalClear.onclick=()=>modalLog.textContent="";

    socket.on("bots",renderCards);
    socket.on("log",({id,text})=>{
      if(attachedId===id){
        modalLog.textContent+=text;
        modalLog.scrollTop=modalLog.scrollHeight;
      }
    });

    // --- Initial Load ---
    fetch("/api/bots").then(r=>r.json()).then(renderCards);

  })();
  </script>
</body>
</html>
