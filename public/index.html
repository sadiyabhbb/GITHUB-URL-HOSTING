<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>HEADSHOT PANEL v4.6</title>
<style>
:root{
  --bg:#050c12;
  --panel:#0f1418;
  --card:#11161a;
  --muted:#9aa3a9;
  --accent:#00ffd1;
  --accent2:#00b3ff;
  --danger:#ff4b4b;
  --font:"Poppins",system-ui,sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:linear-gradient(180deg,var(--bg),#0b0f14);color:#e6f0f2;font-family:var(--font);overflow-x:hidden;animation:fadeIn .8s ease-in}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
header{background:var(--panel);padding:14px 16px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(255,255,255,0.05)}
.brand h1{color:var(--accent);font-size:18px;font-weight:700}
.brand small{color:var(--muted);font-size:12px}
.menu-btn{background:transparent;border:none;font-size:22px;color:var(--accent);cursor:pointer;transition:.2s}
.menu-btn:hover{color:var(--accent2);transform:scale(1.1)}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.3);backdrop-filter:blur(3px);z-index:99;opacity:0;pointer-events:none;transition:.3s}
.overlay.active{opacity:1;pointer-events:auto}
.sidebar{position:fixed;top:0;left:-250px;height:100%;width:230px;background:rgba(15,20,24,0.98);padding:24px 16px;display:flex;flex-direction:column;gap:12px;transition:.3s;border-right:1px solid rgba(255,255,255,0.05);z-index:100;box-shadow:5px 0 20px rgba(0,0,0,0.4)}
.sidebar.active{left:0}
.sidebar button{background:transparent;border:none;text-align:left;padding:10px;border-radius:8px;color:var(--muted);font-size:15px;cursor:pointer;transition:.2s}
.sidebar button:hover{background:rgba(255,255,255,0.05);color:var(--accent);transform:translateX(5px)}
.layout{max-width:1100px;margin:22px auto;padding:0 14px;display:grid;gap:16px}
.panel{background:var(--panel);border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 6px 20px rgba(0,0,0,0.3)}
.cards{display:flex;flex-direction:column;gap:10px;max-height:46vh;overflow:auto}
.card{background:var(--card);border-radius:10px;padding:12px;border:1px solid rgba(255,255,255,0.03);transition:.2s}
.card:hover{transform:scale(1.01);box-shadow:0 0 10px rgba(0,255,209,0.08)}
.card-head{display:flex;justify-content:space-between;align-items:center}
.card-title{font-weight:700;color:var(--accent)}
.meta{color:var(--muted);font-size:13px}
.card-actions{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
.btn{padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700;transition:0.2s}
.btn:hover{transform:scale(1.05)}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.05);color:var(--muted)}
.btn.accent{background:linear-gradient(90deg,var(--accent),var(--accent2));border:none;color:#001}
.btn.danger{background:var(--danger);border:none;color:#fff}
.console{background:#000;color:#fff;font-family:ui-monospace,monospace;padding:12px;border-radius:10px;height:340px;overflow:auto;white-space:pre-wrap;border:1px solid rgba(255,255,255,0.03)}
.controls{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
.host{background:linear-gradient(90deg,rgba(0,255,209,0.03),rgba(0,179,255,0.02));padding:10px;border-radius:8px;font-size:13px;color:var(--muted)}
@media(max-width:920px){.console{height:300px}}
@media(max-width:520px){.console{height:260px}}
</style>
</head>
<body>
<header>
  <div class="brand">
    <h1>HEADSHOT PANEL</h1>
    <small>v4.6 â€¢ Neon Dark</small>
  </div>
  <button id="menuBtn" class="menu-btn">â˜°</button>
</header>

<div id="overlay" class="overlay"></div>
<div id="sidebar" class="sidebar">
  <button id="openServers">Servers</button>
  <button id="openCreate">Create Server</button>
  <button id="refreshAll">Refresh</button>
</div>

<div class="layout">
  <div id="serversPanel" class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:700;color:var(--accent)">Servers</div>
      <div id="summary" class="meta">Loading...</div>
    </div>
    <div style="height:12px"></div>
    <div class="cards" id="cards"></div>
  </div>

  <div id="createPanel" class="panel" style="display:none">
    <div style="font-weight:700;color:var(--accent)">Create Server</div>
    <div style="height:10px"></div>
    <input id="repo" placeholder="Git repo URL" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:var(--card);color:#e6f0f2">
    <div style="height:8px"></div>
    <input id="entry" placeholder="Entry (index.js)" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:var(--card);color:#e6f0f2">
    <div style="height:8px"></div>
    <input id="name" placeholder="Bot name (optional)" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:var(--card);color:#e6f0f2">
    <div style="height:12px"></div>
    <div style="display:flex;gap:8px">
      <button id="createBtn" class="btn accent">Create</button>
      <button id="cancelCreate" class="btn ghost">Cancel</button>
    </div>
  </div>

  <div class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:700;color:var(--accent)">Console</div>
      <div id="attached" class="meta">No bot attached</div>
    </div>
    <div style="height:10px"></div>
    <div id="console" class="console">Console ready...</div>
    <div class="controls">
      <div>
        <button id="copyAll" class="btn ghost">Copy Logs</button>
        <button id="clearAll" class="btn ghost">Clear</button>
      </div>
      <div id="hostInfo" class="host">Host info loading...</div>
    </div>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket=io();
const sidebar=document.getElementById("sidebar");
const overlay=document.getElementById("overlay");
const menuBtn=document.getElementById("menuBtn");
const openServers=document.getElementById("openServers");
const openCreate=document.getElementById("openCreate");
const refreshAll=document.getElementById("refreshAll");
const serversPanel=document.getElementById("serversPanel");
const createPanel=document.getElementById("createPanel");
const cards=document.getElementById("cards");
const summary=document.getElementById("summary");
const consoleEl=document.getElementById("console");
const attached=document.getElementById("attached");
const hostInfo=document.getElementById("hostInfo");
const repoInput=document.getElementById("repo");
const entryInput=document.getElementById("entry");
const nameInput=document.getElementById("name");
const createBtn=document.getElementById("createBtn");
const cancelCreate=document.getElementById("cancelCreate");
const copyAll=document.getElementById("copyAll");
const clearAll=document.getElementById("clearAll");

menuBtn.onclick=()=>{sidebar.classList.add("active");overlay.classList.add("active");};
overlay.onclick=()=>{sidebar.classList.remove("active");overlay.classList.remove("active");};
openServers.onclick=()=>showPanel("servers");
openCreate.onclick=()=>showPanel("create");
refreshAll.onclick=()=>loadBots();

function showPanel(p){
  sidebar.classList.remove("active");
  overlay.classList.remove("active");
  if(p==="servers"){serversPanel.style.display="block";createPanel.style.display="none";}
  else{serversPanel.style.display="none";createPanel.style.display="block";}
}

async function apiPost(path,body){
  const r=await fetch(path,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(body||{})});
  return r.json();
}
async function apiDelete(path){const r=await fetch(path,{method:"DELETE"});return r.json();}

createBtn.onclick=async()=>{
  const repo=repoInput.value.trim();if(!repo)return;
  const entry=entryInput.value.trim()||"index.js";
  const name=nameInput.value.trim();
  createBtn.disabled=true;createBtn.textContent="Deploying...";
  await apiPost("/api/deploy",{repoUrl:repo,name,entry});
  createBtn.disabled=false;createBtn.textContent="Create";
  repoInput.value=entryInput.value=nameInput.value="";
  showPanel("servers");loadBots();
};
cancelCreate.onclick=()=>showPanel("servers");

socket.on("bots",l=>render(l));
socket.on("log",d=>{
  const el=document.getElementById("logs-"+d.id);
  if(el){el.textContent+=d.text;el.scrollTop=el.scrollHeight;}
});

function render(list){
  cards.innerHTML="";
  list.forEach(b=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
    <div class="card-head">
      <div><div class="card-title">${b.name}</div><div class="meta">${b.entry||"index.js"}</div></div>
      <div class="meta">${b.status==="running"?"ðŸŸ¢":"ðŸ”´"} ${b.status}</div>
    </div>
    <div class="card-actions">
      <button class="btn accent start">Start</button>
      <button class="btn ghost stop">Stop</button>
      <button class="btn ghost restart">Restart</button>
      <button class="btn ghost update">Update</button>
      <button class="btn danger delete">Delete</button>
      <button class="btn ghost showLogs">Logs</button>
    </div>
    <div id="logs-${b.id}" style="margin-top:8px;white-space:pre-wrap;font-size:13px;color:var(--muted);max-height:180px;overflow:auto"></div>`;
    card.querySelector(".start").onclick=()=>apiPost(`/api/${b.id}/start`).then(loadBots);
    card.querySelector(".stop").onclick=()=>apiPost(`/api/${b.id}/stop`).then(loadBots);
    card.querySelector(".restart").onclick=()=>apiPost(`/api/${b.id}/restart`).then(loadBots);
    card.querySelector(".update").onclick=()=>apiPost(`/api/${b.id}/update`).then(loadBots);
    card.querySelector(".delete").onclick=()=>apiDelete(`/api/${b.id}/delete`).then(loadBots);
    card.querySelector(".showLogs").onclick=async()=>{
      const r=await fetch(`/api/${b.id}/logs`);const j=await r.json();
      document.getElementById("logs-"+b.id).textContent=(j.logs||[]).join("");
      attached.textContent="Attached: "+b.name;
      socket.emit("subscribe",b.id);
    };
    cards.appendChild(card);
  });
  summary.textContent=`${list.filter(x=>x.status==="running").length} running â€¢ ${list.length} total`;
}

copyAll.onclick=()=>navigator.clipboard.writeText(consoleEl.textContent);
clearAll.onclick=()=>consoleEl.textContent="";

async function loadBots(){
  const r=await fetch("/api/bots");const j=await r.json();render(j);loadHost();
}
async function loadHost(){
  const r=await fetch("/api/host");const j=await r.json();
  hostInfo.innerHTML=`Node: ${j.node} â€¢ Platform: ${j.platform}`;
}
loadBots();setInterval(loadBots,10000);
</script>
</body>
</html>
