<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Xavia Panel v4.7</title>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <style>
    body {
      font-family: "Fira Code", monospace;
      background-color: #0e0e0e;
      color: #ddd;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #161616;
      padding: 10px 20px;
      font-size: 18px;
      color: #ccc;
      box-shadow: 0 0 8px #000;
    }
    .tab {
      cursor: pointer;
      margin: 0 10px;
      padding: 5px 10px;
      border-radius: 8px;
      transition: background 0.3s;
    }
    .tab:hover, .active {
      background: #333;
    }
    .content {
      padding: 15px;
      animation: fadeIn 0.4s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .card {
      background: #1b1b1b;
      padding: 15px;
      border-radius: 10px;
      margin-top: 10px;
      box-shadow: 0 0 8px #000;
    }
    pre {
      background: #0d0d0d;
      color: #00ff90;
      padding: 10px;
      border-radius: 8px;
      height: 300px;
      overflow-y: auto;
    }
    button {
      background: #333;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 5px 10px;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover { background: #555; }
  </style>
</head>
<body>
  <header>
    <div>
      <span class="tab active" id="menu-control">Xavia Control</span>
      <span class="tab" id="menu-logs">Logs</span>
      <span class="tab" id="menu-info">Host Info</span>
    </div>
    <div>Xavia Panel v4.7</div>
  </header>

  <div class="content" id="control">
    <div class="card">ðŸ“¦ No bots yet. Deploy to start.</div>
  </div>

  <div class="content" id="logs" style="display:none;">
    <div class="card"><pre id="logBox">Waiting for logs...</pre></div>
  </div>

  <div class="content" id="info" style="display:none;">
    <div class="card" id="hostInfo">Loading...</div>
  </div>

  <script>
    const socket = io();
    const logBox = document.getElementById("logBox");
    let activeBot = null;

    socket.on("bots", (bots) => {
      const c = document.getElementById("control");
      c.innerHTML = bots.length ? "" : "<div class='card'>ðŸ“¦ No bots yet.</div>";
      bots.forEach(bot => {
        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `
          <b>${bot.name}</b> [${bot.status}]<br>
          <button onclick="viewLogs('${bot.id}')">View Logs</button>
        `;
        c.appendChild(el);
      });
    });

    socket.on("log", ({ id, text }) => {
      if (activeBot === id) {
        logBox.textContent += text;
        logBox.scrollTop = logBox.scrollHeight;
      }
    });

    async function viewLogs(id) {
      activeBot = id;
      document.getElementById("menu-logs").click();
      logBox.textContent = "Fetching logs...";
      const res = await fetch(`/api/${id}/logs`);
      const data = await res.json();
      logBox.textContent = data.logs.join("") || "No logs yet.";
      socket.emit("subscribe", id);
    }

    document.getElementById("menu-control").onclick = () => showTab("control");
    document.getElementById("menu-logs").onclick = () => showTab("logs");
    document.getElementById("menu-info").onclick = () => showTab("info");

    function showTab(tab) {
      ["control","logs","info"].forEach(t=>{
        document.getElementById(t).style.display = t===tab?"block":"none";
        document.getElementById("menu-"+t).classList.toggle("active", t===tab);
      });
    }

    async function loadHost() {
      const res = await fetch("/api/host");
      const data = await res.json();
      document.getElementById("hostInfo").innerHTML = `
        <b>Platform:</b> ${data.platform}<br>
        <b>CPU:</b> ${data.cpus}<br>
        <b>RAM:</b> ${data.memory}<br>
        <b>Bots:</b> ${data.bots}<br>
        <b>Node:</b> ${data.node}<br>
      `;
    }
    loadHost();
  </script>
</body>
</html>
